# Intelligent Placer

## Словарь 
Предмет - физический объект, запечатлённый на фотографиях из датасета (см data)
Алгоритм - последовательность шагов, которая получает на вход объекты из заранее определенного множества и либо останавливается и возвращает какое-то значение, либо возвращает ошибку(Exception)

## Наименование и цель работ
**Наименование:** разработка и поставка алгоритма для проверки возможности расположения предметов внутри многоугольника по снимку предметов и контура многоугольника 

**Цель:** разработка програмного кода, реализующего алгоритм распознающий предметы из фиксированного списка и проверяющий возможность расположить предметы внутри многоугольника

## Наименование Заказчика и Исполнителя
**Заказчик:** adts-----@bk.ru + vikt-----@gmail.com 

**Исполнитель:** Марин Е.В.

## Содержание работ  
Работы включают в себя:
- Разработку и поставку библиотеки, реализующей алгоритм для распознавания предметов и проверки возможности расположить предметы внутри многоугольник. Библиотека должна быть написана на языке python и должна поставлять функцию со следующим прототипом: def check_image(<path_to_png_jpg_image_on_local_computer>);
- Подготовку инструкции с перечислением шагов, необходимых для запуска когда на локальном устрйостве заказчика; (зависимости, venv, python, ...) 
- Проведение показательного эксперемента на репрезентативных данных для демонстрации работоспособности алгоритма;
- Написание отчёта по проделанной работе. 

## Требования к входнным данным
- Алгоритм принимает на вход путь к файлу, содержащему растровую фотографию в одном из общепринятых форматов (.jpg, .png).
- Файл должен содержаться на том же устройстве, на котором исполняется исходный код. Загрузка файлов из облачного хранилища не предусмотрена.
- Фотография должна содержать любое подмножество предметов, утверждённых с заказчиком, расположенных под листом бумаги А4, на котором темной непрерывной линией нарисован многоугольник.
- Лист бумаги должен быть чистым и должен быть расположен на фотографии так, чтобы длиннейшая его сторона проходила слева направо.
- Предметы должны быть строго разделены между собой более, чем на 4 пикселя и должны быть отделены от листа бумаги на расстояние более 4 пикселей. (предметы не лежат на листке или друг на друге)
- Предметы должны сохранять свою конфигурацию на всех снимках. (например, ручка с колпачком и ручка без колпачка - это разные предметы, телефон экраном вниз и телефон экраном вверх - это разные предметы, телефон, повернутый относительно нормали к своему экрану под любым углом - это один и тот же предмет)
- Один предмет не может присутствовать на входной фотографии в нескольких копиях.
- Фотографии должны быть сделаны серху-вниз. (угол отклонения объектива от вертикали при фотографировании не более 30 градусов)
- На фотографии не должно прсиутствовать артефактов, связанных с плохой освещённостью. (нету засветов, тёмных участков, ярких пятен, вызванных окрашенным освещением высокой интенсивности)
- Разрешение фотографий не менее 1280х800.

## Описание ожидаемого использования програмного продукта
1. Фотография, подходящая по всем критериям из предыдущего пункта загружается в файловую систему, в которой расположен исходный код программы;
2. Исходный код запускается в заранее подготовленном окружении, содержащем все необходимые зависимости. В качестве параметра, функция check_image принимает путь к файлу, харнящему входное изображение;
3. В качестве выходных данных функция возвращает одно из трёх значений: True/False/None. (True - данные корректны, предметы нельзя поместить в многоугольник; False - данные корректны, предметы можно поместить в многоугольник; None - данные не прошли валидацию и ответ не может быть получен)

## План реализации
### Первоначальный алгоритм
- Обрабатываем объекты на эталонных фотографих(на фоне белого листа): ищем особые точки, сохраняем контур(детектор Кенни);
- Находим на верхней части изображения полигон и сохраняем его контур;
- Пытаемся сопоставить каждому эталонному объекту объект из композиции с помощью особых точек: используем число найденных особых точек для меры качества сопоставления. Например, для деревянного магнита найдено 250 особых точек, значит для него ожидается множество совпадений. Для маркера найдено 16 особых точек, поэтому достаточно 10 особых точек, чтобы сопоставить объекты;
- Укладываем объекты внутрь полигона. Сравниваем сумму площадей объектов с плозадью полигона.


## Планы по улучшению
1. В первую очередь нужно попытаться улучшить алгоритм детекции предметов - он самое узкое место текущей реализации. Теоретически SIFT должен справляться с данной задачей, однако на практике возникли следующие проблемы, которые необходимо решить:
 - Шумный фон. Ворс на полотенце создаёт множество особых точек. От него можно избавится с помощью фильтров;
 - Сомнительные особые точки для некоторых предметов. Необходимо улучшить алгоритм поиска особых точек и предобрабатывать входные данные, напр. увеличивать контрастность.
Если не удастся найти решение с особыми точками для всех объектов, можно попытаться использовать априорные знания о предметах, которые будут извлекаться в автоматическом режиме на этапе предобработки: цвет, размер, ...
2. Найти алгоритм для укладки контуров внутрь полигона. Вероятно, это оптимизационная задача, поэтому она должна быть решена в каком-то виде. Это позволит решать более сложные задачи успешно.

## Описание классов программы
*Object* - класс, оперирующий с предметами (хранит контуры, изображение, фильтры, умеет считать площадь)
*Polygon* - класс, реализующий полигон (хранит контур, изображение, умеет считать площадь и располагать внутри себя объекты класса *Object*)
*Scene* - класс, реализующий композицию (хранит объекты и полигон, организует связь между полигоном и объектами, находит на исходном иображении объекты и трансформирует их)
